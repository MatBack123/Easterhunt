<!DOCTYPE html>
<html lang="nl">
  <head>
    <meta charset="UTF-8" />
    <title>Mini Paasei Puzzel</title>
    <style>
      body {
        font-family: sans-serif;
        background: #f5f5f5;
        text-align: center;
        padding: 30px;
      }

      #board {
        position: relative;
        width: 512px;
        height: 340px;
        margin: 0 auto;
        border: 2px solid #333;
        background-color: #ddd;
        touch-action: none;
      }

      .piece {
        position: absolute;
        width: calc(512px / 2);
        height: calc(340px / 2);
        background-image: url("Het-paasei-mysterie-1024x680.png");
        background-size: 512px 340px;
        cursor: grab;
        border: 1px solid rgba(0, 0, 0, 0.2);
        touch-action: none;
      }

      #qr {
        margin-top: 30px;
        display: none;
      }

      #qr img {
        border: 2px dashed #333;
        padding: 10px;
        background: white;
      }

      h1 {
        margin-bottom: 20px;
      }
    </style>
  </head>
  <body>
    <h1>Sleep de 4 stukjes op hun plek</h1>
    <div id="board"></div>

    <div id="qr">
      <img
        src="https://api.qrserver.com/v1/create-qr-code/?data=https://jouwlinkhier.nl&size=200x200"
        alt="QR Code"
      />
      <p><strong>ðŸŽ‰ Goed gedaan! Scan de QR-code!</strong></p>
    </div>

    <script>
      const rows = 2, cols = 2;
      const pieceWidth = 512 / cols;
      const pieceHeight = 340 / rows;

      const board = document.getElementById("board");
      const pieces = [];

      function createPieces() {
        for (let row = 0; row < rows; row++) {
          for (let col = 0; col < cols; col++) {
            const piece = document.createElement("div");
            piece.classList.add("piece");
            piece.dataset.correctRow = row;
            piece.dataset.correctCol = col;

            piece.style.backgroundPosition = `-${col * pieceWidth}px -${row * pieceHeight}px`;

            const randX = Math.random() * (board.clientWidth - pieceWidth);
            const randY = Math.random() * (board.clientHeight - pieceHeight);
            piece.style.left = randX + "px";
            piece.style.top = randY + "px";

            piece.addEventListener("mousedown", dragStart);
            piece.addEventListener("touchstart", dragStart, { passive: false });

            board.appendChild(piece);
            pieces.push(piece);
          }
        }
      }

      function dragStart(e) {
        e.preventDefault();
        const piece = this;
        const isTouch = e.type === "touchstart";
        const clientX = isTouch ? e.touches[0].clientX : e.clientX;
        const clientY = isTouch ? e.touches[0].clientY : e.clientY;

        let shiftX = clientX - piece.getBoundingClientRect().left;
        let shiftY = clientY - piece.getBoundingClientRect().top;

        function moveAt(x, y) {
          piece.style.left = x - shiftX - board.offsetLeft + "px";
          piece.style.top = y - shiftY - board.offsetTop + "px";
        }

        function onMove(e) {
          const x = isTouch ? e.touches[0].pageX : e.pageX;
          const y = isTouch ? e.touches[0].pageY : e.pageY;
          moveAt(x, y);
        }

        function onEnd() {
          document.removeEventListener(isTouch ? "touchmove" : "mousemove", onMove);
          document.removeEventListener(isTouch ? "touchend" : "mouseup", onEnd);
          snapToGrid(piece);
          checkIfSolved();
        }

        document.addEventListener(isTouch ? "touchmove" : "mousemove", onMove, { passive: false });
        document.addEventListener(isTouch ? "touchend" : "mouseup", onEnd);
      }

      function snapToGrid(piece) {
        let left = parseFloat(piece.style.left);
        let top = parseFloat(piece.style.top);

        let col = Math.round(left / pieceWidth);
        let row = Math.round(top / pieceHeight);

        // Snap to grid
        piece.style.left = col * pieceWidth + "px";
        piece.style.top = row * pieceHeight + "px";

        piece.dataset.currentRow = row;
        piece.dataset.currentCol = col;
      }

      function checkIfSolved() {
        const allCorrect = pieces.every(
          (p) =>
            p.dataset.correctRow == p.dataset.currentRow &&
            p.dataset.correctCol == p.dataset.currentCol
        );

        if (allCorrect) {
          document.getElementById("qr").style.display = "block";
        }
      }

      createPieces();
    </script>
  </body>
</html>
